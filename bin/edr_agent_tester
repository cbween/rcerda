#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "cbween_edr_agent"
require 'semantic_logger'
Dir[File.expand_path('../lib/cbween_edr_agent/**/*', __dir__)].each {|d| require d unless File.directory? d }

app_name = $0.split("/").last
SemanticLogger.default_level = :debug # TODO: ENV Var
SemanticLogger.add_appender(file_name: "output.log", application: app_name, formatter: :json)

begin
  testing_agent = CbweenEdrAgent::EdrAgent.new
  testing_agent.run
rescue CbweenEdrAgent::EdrAgent::EdrAgentFailure => e
  STDERR.puts e.message
  STDERR.puts e.options if e.options
  exit(1)
end
