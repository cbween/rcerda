#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "cbween_edr_agent"
require 'semantic_logger'

app_name = $0.split("/").last
SemanticLogger.default_level = :debug # TODO: ENV Var
SemanticLogger.add_appender(io: $stdout, application: app_name, formatter: :json)
SemanticLogger.add_appender(file_name: "output.log", application: app_name, formatter: :json)

begin
  CbweenEdrAgent::EdrAgent.run
rescue CbweenEdrAgent::EdrAgent::EdrAgentFailure => e
  # TODO: ensure good logging formats are enfored here
  STDERR.puts e.message
  STDERR.puts e.options if e.options
  exit(1)
end